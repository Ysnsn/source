var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);o.prototype=e.prototype,t.prototype=new o},__awaiter=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,r){function a(t){try{l(i.next(t))}catch(e){r(e)}}function s(t){try{l(i["throw"](t))}catch(e){r(e)}}function l(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(a,s)}l((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){l.label=o[1];break}if(6===o[0]&&l.label<a[1]){l.label=a[1],a=o;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(o);break}a[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(i){o=[6,i],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,r,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BoxSprite=function(t){function e(){var e=t.call(this)||this;return e.boxId=0,e.init(),e}return __extends(e,t),e.prototype.init=function(){this.box=new egret.Bitmap,this.box.texture=RES.getRes("BoxLadyComeOut1"),this.addChild(this.box),this.box1=new egret.Bitmap,this.box1.texture=RES.getRes("box_png"),this.box1.x=178,this.box1.y=354,this.box1.alpha=0,this.addChild(this.box1),this.box1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBox,this)},e.prototype.clickBox=function(t){this.dispatchEvent(new egret.TouchEvent("CLICK_BOX"))},e.prototype.initBox=function(){this.box.texture=RES.getRes("BoxLadyComeOut1")},e.prototype.touchBox=function(t){this.box1.touchEnabled=t},e.prototype.boxLadyOut=function(){var t=this,e=[1,2,3,4,5,5,4,3,2,1],o=0,i=egret.Tween.get(this.box,{loop:!0}).call(function(){o++,t.box.texture=RES.getRes("BoxLadyComeOut"+e[o]),e.length-1==o&&(i.setPaused(!0),GameMain.getInstance().startTime())}).wait(200)},e.prototype.boxLadyOut1=function(){var t=this,e=0,o=egret.Tween.get(this.box,{loop:!0}).call(function(){e++,t.box.texture=RES.getRes("BoxLadyComeOut"+e),e>=5&&o.setPaused(!0)}).wait(200)},e.prototype.EmptyBoxOpen=function(t){var e=this;void 0===t&&(t=null);var o=1,i=egret.Tween.get(this.box,{loop:!0}).call(function(){o++,e.box.texture=RES.getRes("EmptyBoxOpen"+o),o>=5&&(i.setPaused(!0),null!=t&&t())}).wait(200)},e.prototype.EmptyBoxClose=function(){var t=this,e=5,o=egret.Tween.get(this.box,{loop:!0}).call(function(){e--,t.box.texture=RES.getRes("EmptyBoxOpen"+e),1>=e&&o.setPaused(!0)}).wait(200)},Object.defineProperty(e.prototype,"id",{get:function(){return this.boxId},set:function(t){this.boxId=t},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BoxSprite.prototype,"BoxSprite");var GameData=function(){function t(){}return t.Level=function(){t.totalMoveNum=t.levelArray[t.levelClassNum.toString()]["level"+t.level].totalMoveNum,t.boxTimeNum=t.levelArray[t.levelClassNum.toString()]["level"+t.level].boxTimeNum,3==t.level&&2==t.difficultModel&&(t.totalMoveNum=t.levelArray[t.levelClassNum.toString()]["level"+(t.level+1)].totalMoveNum,t.boxTimeNum=t.levelArray[t.levelClassNum.toString()]["level"+(t.level+1)].boxTimeNum)},t.level=1,t.totalMoveNum=1,t.boxTimeNum=600,t.levelClassNum=1,t.difficultModel=1,t.doubleModel=0,t.levelArray={1:{level1:{totalMoveNum:1,boxTimeNum:313},level2:{totalMoveNum:1,boxTimeNum:227},level3:{totalMoveNum:1,boxTimeNum:166},level4:{totalMoveNum:1,boxTimeNum:147}},2:{level1:{totalMoveNum:1,boxTimeNum:227},level2:{totalMoveNum:1,boxTimeNum:166},level3:{totalMoveNum:1,boxTimeNum:113},level4:{totalMoveNum:1,boxTimeNum:104}}},t}();__reflect(GameData.prototype,"GameData");var GameMain=function(t){function e(){var o=t.call(this)||this;if(o.boxNum=0,o.clickTimeNum=5,e.instance)throw"单例异常";return o.init(),o}return __extends(e,t),e.getInstance=function(){return e.instance||(this.instance=new e),e.instance},e.prototype.init=function(){this.clock=new egret.Bitmap,this.addChild(this.clock),this.clock.texture=RES.getRes("clock1_png"),this.clock.anchorOffsetX=this.clock.width/2,this.clock.anchorOffsetY=this.clock.height/2,this.clock.x=267,this.clock.y=114;var t=new egret.Bitmap;this.addChild(t),t.texture=RES.getRes("clock2_png"),t.x=352,t.y=84,this.boxArray=[],this.boxLocationArray=[new egret.Point(-147,255),new egret.Point(304,255),new egret.Point(75,334)];for(var e=0;3>e;e++){var o=new BoxSprite;this.addChild(o),o.id=e,o.x=this.boxLocationArray[e].x,o.y=this.boxLocationArray[e].y,o.addEventListener("CLICK_BOX",this.clickBox,this),this.boxArray.push(o)}this.txt=new egret.TextField,this.addChild(this.txt),this.txt.size=60,this.txt.text="5",this.txt.textColor=691790,this.txt.bold=!0,this.txt.stroke=2,this.txt.strokeColor=16777215,this.txt.x=409,this.txt.y=97,this.tipTxt=new egret.TextField,this.addChild(this.tipTxt),this.tipTxt.size=36,this.tipTxt.text="43君助力中，挑战成功盒币翻倍",this.tipTxt.bold=!0,this.tipTxt.x=375-this.tipTxt.width/2,this.tipTxt.y=217,this.tipTxt.visible=!1,this.moveBox=[],this.leveltxt=new egret.TextField,this.leveltxt.size=30,this.leveltxt.text="第"+GameData.level+"关",this.leveltxt.x=50,this.leveltxt.y=97},e.prototype.initGame=function(){this.boxNum=Math.floor(3*Math.random()),GameData.Level(),this.tipTxt.visible=Boolean(GameData.doubleModel),this.leveltxt.text="第"+GameData.level+"关"+(2==GameData.levelClassNum?"高级场":"初级场"),GameData.totalMoveNum<13?this.moveBoxArray=[2,1,0,2,1,0,1,2,0]:this.moveBoxArray=[1,0,2,0,1,2,0,2,1,0,1,2,0,1,2],this.clock.rotation=0,this.timer=new egret.Timer(GameData.boxTimeNum),this.timer.addEventListener(egret.TimerEvent.TIMER,this.enterTimer,this),this.moveBox=[],this.moveBox=[this.boxNum,this.getNumber(this.boxNum)],this.boxArray[this.boxNum].boxLadyOut(),this.boxArray.forEach(function(t){t.touchBox(!1),t.initBox()}),this.clickTimeNum=5,this.txt.text=this.clickTimeNum.toString()},e.prototype.startTime=function(){this.timer.start()},e.prototype.clickBox=function(t){var e=this;if(egret.Tween.removeAllTweens(),this.boxArray.forEach(function(t){t.touchBox(!1)}),this.boxNum==t.target.id){if(t.target.x==this.boxLocationArray[2].x&&this.addChild(this.boxArray[t.target.id]),t.target.boxLadyOut1(),JSInterface.gameEnd(GameData.level),3==GameData.level)return void console.log("游戏结束");GameData.level++}else t.target.x==this.boxLocationArray[2].x&&this.addChild(this.boxArray[t.target.id]),t.target.EmptyBoxOpen(),setTimeout(function(){e.boxArray[e.boxNum].boxLadyOut1()},1e3),setTimeout(function(){e.gameOver()},3500)},e.prototype.enterTimer=function(t){var e=this;GameData.totalMoveNum--,this.changPosition(this.boxArray[this.moveBox[0]],this.boxArray[this.moveBox[1]],GameData.boxTimeNum),GameData.totalMoveNum<13&&this.moveBoxArray.length>0?(this.moveBox.shift(),this.moveBox[0]==this.moveBoxArray[0]?(this.moveBoxArray.unshift(this.getNumber(this.moveBox[0])),this.moveBox.push(this.moveBoxArray[0]),this.moveBoxArray.shift()):(this.moveBox.push(this.moveBoxArray[0]),this.moveBoxArray.shift())):(this.moveBox.shift(),this.moveBox.push(this.getNumber(this.moveBox[0]))),GameData.totalMoveNum<=0&&(this.timer.stop(),this.boxArray.forEach(function(t){t.x==e.boxLocationArray[2].x&&e.addChild(t)}),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.enterTimer,this),setTimeout(function(){e.showClockTxt()},GameData.boxTimeNum))},e.prototype.showClockTxt=function(){var t=this;this.boxArray.forEach(function(t){t.touchBox(!0)}),this.txt.text=this.clickTimeNum.toString(),egret.Tween.get(this.clock,{loop:!0}).to({rotation:20},100).to({rotation:0},100).to({rotation:-20},100).to({rotation:0},100),egret.Tween.get(this.txt,{loop:!0}).call(function(){t.clickTimeNum--,t.txt.text=t.clickTimeNum.toString(),0==t.clickTimeNum&&t.gameOver()}).wait(1e3)},e.prototype.getNumber=function(t){var e=[0,1,2],o=e.indexOf(t);e.splice(o,1);var i=e[Math.floor(2*Math.random())];return i},e.prototype.changPosition=function(t,e,o){var i=this,n=new egret.Point,r=new egret.Point;n.x=t.x,n.y=t.y,r.x=e.x,r.y=e.y,egret.Tween.get(t).to({x:r.x,y:r.y},o-25).call(function(){t.x==i.boxLocationArray[2].x&&i.addChild(t)}),egret.Tween.get(e).to({x:n.x,y:n.y},o-25).call(function(){e.x==i.boxLocationArray[2].x&&i.addChild(e)})},e.prototype.gameOver=function(){GameData.level=1,egret.Tween.removeAllTweens(),this.boxArray.forEach(function(t){t.touchBox(!1)}),JSInterface.gameEnd(0)},e.prototype.pauseGame=function(t){t?(this.timer.stop(),this.boxArray.forEach(function(t){egret.Tween.pauseTweens(t)}),egret.Tween.pauseTweens(this.clock),egret.Tween.pauseTweens(this.txt)):(this.timer.start(),this.boxArray.forEach(function(t){egret.Tween.resumeTweens(t)}),egret.Tween.resumeTweens(this.clock),egret.Tween.resumeTweens(this.txt))},e}(egret.Sprite);__reflect(GameMain.prototype,"GameMain");var JSInterface=function(){function t(){}return t.loadingOver=function(){try{parent.MPage.loadOver()}catch(t){console.log("eeee,",t)}},t.gameEnd=function(t){try{parent.MPage.gameEnd(t)}catch(e){console.log("eeee,",e)}},t.playGame=function(t,e,o){GameData.levelClassNum=t,GameData.difficultModel=e,GameData.doubleModel=o,GameMain.getInstance().initGame()},t.pauseGame=function(t){GameMain.getInstance().pauseGame(Boolean(t))},t}();__reflect(JSInterface.prototype,"JSInterface");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.loading1=new egret.Bitmap,this.addChild(this.loading1),this.loading1.texture=RES.getRes("loading1"),this.loading1.x=66,this.loading1.y=317,this.loading2=new egret.Bitmap,this.addChild(this.loading2),this.loading2.texture=RES.getRes("loading2"),this.loading2.x=66,this.loading2.y=317;var t=new egret.Bitmap;this.addChild(t),t.texture=RES.getRes("loading1"),t.x=66,t.y=317,this.loading1.mask=t,this.loading1.x=this.loading2.x-t.width,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=380,this.textField.x=275,this.textField.textColor=47986,this.textField.size=48,this.textField.width=200,this.textField.height=100,this.textField.textAlign="center",this.boxArray=[];for(var e=0;3>e;e++){var o=new egret.Bitmap;this.addChild(o),0==e?o.texture=RES.getRes("loadingbox1"):o.texture=RES.getRes("loadingbox2"),o.x=143+(o.width+20)*e,o.y=145,o.id=e,this.boxArray.push(o)}this.boxArray.forEach(function(t){egret.Tween.get(t,{loop:!0}).call(function(){t.id--,t.id<0&&(t.id=2),0==t.id?t.texture=RES.getRes("loadingbox1"):t.texture=RES.getRes("loadingbox2")}).wait(300)})},e.prototype.onProgress=function(t,e){this.textField.text=Math.floor(t/e*100)+"%",this.loading1.x=this.loading2.x-this.loading2.width*(1-t/e)},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(o){switch(o.label){case 0:return[4,this.loadResource()];case 1:return o.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=o.sent(),[4,platform.login()];case 3:return o.sent(),[4,platform.getUserInfo()];case 4:return e=o.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return o.sent(),[4,RES.loadGroup("loading")];case 2:return o.sent(),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadGroup("preload",0,t)];case 3:return o.sent(),this.stage.removeChild(t),[3,5];case 4:return e=o.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.createGameScene=function(){this.addChild(GameMain.getInstance()),GameMain.getInstance().x=this.stage.stageWidth/2-375,JSInterface.loadingOver()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,o=RES.getRes(t);return e.texture=o,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);